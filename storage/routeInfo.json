{"path":"storage","templateID":1,"sharedPropsHashes":{"apiList":"17j4mt"},"localProps":{"reference":{"title":"サーバーにセーブを保存する","slug":"storage","description":"サーバーセーブ機能を利用するにはStorageAPIを利用してください。サーバーセーブ機能は現在APIのみで利用が可能で、プラグインを通じた機能利用はできません。","order":12,"contents":"<h2>概要</h2>\n<p>StorageAPIはサーバーセーブを可能にするAPIです。</p>\n<h3>どんなことができるの？</h3>\n<p>機能を実行した際に、次のような操作を行います。</p>\n<ul>\n<li>ゲーム内のセーブ情報をサーバーに保存する</li>\n<li>サーバーに保存したセーブデータの削除を行う</li>\n<li>サーバーに保存したセーブ情報を取得する</li>\n</ul>\n<p>サーバーセーブに成功した場合、以下のようなポップアップが表示されます。</p>\n<p><img src=\"https://atsumaru.github.io/api-references/images/storage.png\" alt=\"サーバーセーブ\"></p>\n<h3>利用例</h3>\n<p>RPGツクールMVを含む <code>LocalStorage</code> を利用するゲームエンジンは、RPGアツマールが挿入する <code>rpgatsumaru.js</code> によって自動的にこの機能を利用しています。例えば以下のゲームがこの機能を利用してサーバーセーブを実行しています。</p>\n<ul>\n<li><a href=\"https://game.nicovideo.jp/atsumaru/games/gm7601\">【防衛ゲーム】タタの魔法使い【異世界サバイバル】</a><ul>\n<li>ゲーム内でセーブを実行した際に、<code>rpgatsumaru.js</code> が LocalStorage のデータを読み取り、自動的にサーバーへ保存しています。</li>\n</ul>\n</li>\n</ul>\n<h2>詳細</h2>\n<p>Stringを保存するシンプルなKVS（Key-Valueストア)になっています。セーブはゲームID(gm123等)ごとに独立しています。\nセーブデータの保存領域にはニコニコユーザーIDごとに上限があります。1kbで1ブロックとして、90ブロックまで保存ができます。セーブデータは保存時に自動的に圧縮され、圧縮後のファイルサイズを見ています。StorageAPIは複数端末からセーブされることを想定しています。</p>\n<h3>保存のkeyについて</h3>\n<ul>\n<li>推奨のkeyは「system」と「dataN」(Nは数字)です。この2種のキーはRPGアツマール側のセーブ管理画面で、それぞれ「システムファイル」と「ファイル N」として扱われます。この2つ以外はゲーム上で「その他」と表示されます。</li>\n<li>「RPG Global」、「RPG Config」、「RPG FileN」(Nは数字)はRPGツクールMV用にカスタマイズされているため、RPGツクールMV以外ではセーブのキーとしては使わないでください。</li>\n</ul>\n<h2>設置方法</h2>\n<p>サーバーセーブ機能はアツマールAPIから利用可能です。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">方法</th>\n<th align=\"left\">場所</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">アツマール API</td>\n<td align=\"left\">-</td>\n</tr>\n</tbody></table>\n<h2>APIを利用したサーバーセーブ機能の利用</h2>\n<h3>サーバーセーブ全件取得API</h3>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\">window.RPGAtsumaru.storage.getItems()</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\">サーバーに保存されているセーブデータを全件取得します。</td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">なし</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\">Thenable&lt;{key: string, value: string}[]&gt;</td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/10/25</td>\n</tr>\n</tbody></table>\n<h3>サーバーセーブ保存API</h3>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\">window.RPGAtsumaru.storage.setItems(items)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\">引数に指定したitemsに対応するセーブデータを保存します。<br>複数端末からのセーブ時に楽観的ロックをしています。A端末とB端末で同時にゲームをプレイしていた場合にAとBがほぼ同時にsetItems()をした場合、先にsetItems()したもののみが受理されます。後のものは一度getItems()で最新のセーブデータを取得した後で受け付けとなります。<br>サーバーアクセスが発生します。</td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">更新する対象のセーブ情報。型は {key: string, value: string}[]</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\">Thenable<void></td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/10/25</td>\n</tr>\n</tbody></table>\n<h3>サーバーセーブ削除API</h3>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\">window.RPGAtsumaru.storage.removeItem(key)</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\">指定したセーブデータを削除します。<br>サーバーアクセスが発生します。</td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">削除対象のセーブのキー。型はstring</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\">Thenable<void></td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/10/25</td>\n</tr>\n</tbody></table>\n"},"title":"サーバーにセーブを保存する","path":"/storage"}}
